---
title: 'Rã«ã‚ˆã‚‹è‡ªç„¶è¨€èªå‡¦ç†ï¼ˆtidymodels, BPE, fasttext, XGBoostï¼‰'
emoji: 'ğŸŒ¿'
type: 'tech'
topics: ['r','nlp','fasttext']
published: true
author: 'paithiov909'
canonical: 'https://zenn.dev/paithiov909/articles/4a25884405700ca47c11'
---

## ã“ã®è¨˜äº‹ã«ã¤ã„ã¦

[ä»¥å‰ã«æ›¸ã„ãŸè¨˜äº‹](https://github.com/paithiov909/wabbitspunch/blob/master/content/articles/about.md)ã‚’ç„¼ãç›´ã—ã—ã¤ã¤ã€ã°ã‚“ãã—ã•ã‚“ã®ä»¥ä¸‹ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã®ã¾ã­ã‚’Rã§ã‚„ã£ã¦ã¿ã¾ã™ã€‚

- [Rustã«ã‚ˆã‚‹linderaã€neologdã€fasttextã€XGBoostã‚’ç”¨ã„ãŸãƒ†ã‚­ã‚¹ãƒˆåˆ†é¡ - Stimulator](https://vaaaaaanquish.hatenablog.com/entry/2020/12/14/192246)

ã°ã‚“ãã—ã•ã‚“ã®è¨˜äº‹ã¯ã€ŒPythonã©ã“ã¾ã§è„±å´ã§ãã‚‹ã®ã‹è¦‹ã‚‹ã®ã‚‚å…¼ã­ã¦ã€ã¨ã„ã†ã“ã¨ã§ã€Rustã§è‡ªç„¶è¨€èªå‡¦ç†ã‚’è©¦ã—ã¦ã„ã¾ã™ã€‚ç§ã¯ã¹ã¤ã«è‡ªç„¶è¨€èªå‡¦ç†ã‚’å®Ÿå‹™ã§ã‚„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã‹ã§ã¯ãªã„ã§ã™ãŒã€Pythonã˜ã‚ƒãªãã¦Rustã¨ã‹Goã¨ã„ã£ãŸé™çš„å‹ä»˜ã‘ã§é€Ÿã„è¨€èªã§å®‰å…¨ã«æ›¸ã‘ãŸã‚‰ã†ã‚Œã—ã„å ´é¢ãŒã‚ã‚‹ã‚ˆã­ã€ã¿ãŸã„ãªãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãªã®ã‹ãªã¨æƒ³åƒã—ã¦ã„ã¾ã™ã€‚

å®Ÿéš›ã®ã¨ã“ã‚ã€è‡ªåˆ†ã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ããªãŒã‚‰è‡ªç„¶è¨€èªå‡¦ç†ã®çœŸä¼¼äº‹ã‚’ã™ã‚‹ãªã‚‰ä¾ç„¶ã¨ã—ã¦PythonãŒä¾¿åˆ©ã§ã™ã€‚Rã¨æ¯”ã¹ã¦ã‚‚ã€Pythonã«ã¯[SudachiPy](https://github.com/WorksApplications/SudachiPy)ã‚„[janome](https://mocobeta.github.io/janome/)ã¨ã„ã£ãŸé¸æŠè‚¢ãŒã‚ã‚‹ä¸€æ–¹ã§ã€Rã«ã¯Rã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã®ã¿ã§å°å…¥ãŒå®Œäº†ã™ã‚‹å½¢æ…‹ç´ è§£æã®æ‰‹æ®µãŒï¼ˆå°‘ãªãã¨ã‚‚CRANã«ã¯ï¼‰ã‚ã‚Šã¾ã›ã‚“ã€‚è‡ªç„¶è¨€èªå‡¦ç†ã‚’ã‚„ã‚‹è¨€èªã¨ã—ã¦Pythonã®ã»ã†ãŒãƒ¡ã‚¸ãƒ£ãƒ¼ãªã“ã¨ã«ã¯ã»ã‹ã«ã‚‚ã„ãã¤ã‹ã®ç†ç”±ã¨ã„ã†ã‹çµŒç·¯ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ãŒã€Pythonã‚’æ¡ç”¨ã—ãŸã»ã†ãŒã‚ˆã„ã²ã¨ã¤ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã¯ã€ãƒ†ã‚­ã‚¹ãƒˆãƒã‚¤ãƒ‹ãƒ³ã‚°ã—ã¦å¾—ãŸç‰¹å¾´é‡ã‚’æŠ•å…¥ã—ã¦ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’ã—ãŸã„å ´åˆã¯äº‹å®Ÿä¸ŠPythonã‚’é¸æŠã™ã‚‹ã—ã‹ãªã„ã¨ã„ã†ã®ã‚‚ã‚ã‚‹æ°—ãŒã—ã¾ã™ã€‚ä¸€å¿œã€[{keras}](https://keras.rstudio.com/)ã‚„[{torch}](https://github.com/mlverse/torch)ã¨ã„ã†ã®ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã“ã®ã‚ãŸã‚Šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã®ã¯ã¾ã è¶£å‘³ã®é ˜åŸŸãªæ°—ãŒã—ã¾ã™ã€‚

ãã†ã¯ã„ã£ã¦ã‚‚ã€[{RMeCab}](https://sites.google.com/site/rmecab/)ã¯å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ãªãœã‹Rã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆãƒã‚¤ãƒ‹ãƒ³ã‚°ã«å…¥ã£ã¦ã—ã¾ã£ãŸäººé–“ã«ã¨ã£ã¦ã€æ¯”è¼ƒçš„ç°¡å˜ã«å°å…¥ã§ãã¦ã»ã¨ã‚“ã©ç’°å¢ƒã‚’å•ã‚ãšã™ãä½¿ãˆã‚‹RMeCabã¯æ¬ ã‹ã›ãªã„ãƒ„ãƒ¼ãƒ«ã ã£ãŸã“ã¨ã§ã—ã‚‡ã†ã€‚ãŸã ã€Rã«æ…£ã‚Œã¦ãã¦ã„ã‚ã„ã‚ãªã“ã¨ã‚’ã‚„ã£ã¦ã¿ãŸããªã‚‹ã¨ã€RMeCabã¯ã€Œãªã‚“ã‹ä½¿ã„ã«ãã„ãªã€ã¿ãŸã„ã«ãªã‚ŠãŒã¡ã§ã™ã€‚Rã§ã‚‚è‡ªç„¶è¨€èªå‡¦ç†ã‚’ã‚„ã‚‹ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã«ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ãŸãã•ã‚“ã‚ã‚‹ã®ã§ã™ãŒã€ãã‚‚ãã‚‚æ—¥æœ¬èªæƒ…å ±ãŒã‚ã¾ã‚Šãªã„ã—ã€ãã“ãã“ãŒã‚“ã°ã‚‰ãªã„ã¨è©°ã¾ã‚Šã¾ã™ã€‚

https://twitter.com/dataandme/status/1092509662384189441

ã§ã‚‚ã¾ã‚Rã§ã‚‚ã§ããªãã¯ãªã„ã‚“ã ã‚ˆã¨ã„ã†ã®ã‚’ã—ã‚ã™ç›®çš„ã§ã€ã“ã“ã§ã¯å…ˆã®è¨˜äº‹ã¨åŒã˜ã‚ˆã†ãªã“ã¨ã‚’Rã§ã‚„ã£ã¦ã„ãã¾ã™ã€‚

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®é¸å®šã«ã‚ãŸã£ã¦

### Tokenization

å½¢æ…‹ç´ è§£æãªã©ã‚’ã‚„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ã¯æ¬¡ã«æŒ™ã’ã‚‹ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚çŸ¥ã‚‹ã‹ãã‚Šã§ã¯ãœã‚“ã¶å€‹äººé–‹ç™ºã§ã€ç’°å¢ƒã‚„ä½¿ç”¨ã™ã‚‹è¾æ›¸ã€è§£æã™ã‚‹æ–‡å­—åˆ—ãªã©ã«ã‚ˆã£ã¦ä¸Šæ‰‹ãå‹•ã„ãŸã‚Šå‹•ã‹ãªã‹ã£ãŸã‚Šã—ã¾ã™ã€‚Neologdè¾æ›¸ã‚’ä½¿ã†ãªã‚‰RcppMeCabã«ã™ã¹ãã§ã™ãŒã€ãƒ¡ãƒ³ãƒ†ãƒŠã®äººãŒæœ€è¿‘å¿™ã—ã„ã¨ã‹ã§ã€ã‚ã¾ã‚Šã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«é–‹ç™ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

- [IshidaMotohiro/RMeCab: Interface to MeCab](https://github.com/IshidaMotohiro/RMeCab)
- [junhewk/RcppMeCab: RcppMeCab: Rcpp Interface of CJK Morpheme Analyzer MeCab](https://github.com/junhewk/RcppMeCab)
- [uribo/sudachir: R Interface to 'Sudachi'](https://github.com/uribo/sudachir)
- [paithiov909/rjavacmecab: rJava Interface to CMeCab](https://github.com/paithiov909/rjavacmecab)

Universal Dependenciesãªã‚‰æ¬¡ãŒä½¿ãˆã¾ã™ã€‚udpipeã¯C++å®Ÿè£…ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã€spacyrã¯Pythonãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã™ã€‚

- [bnosac/udpipe: R package for Tokenization, Parts of Speech Tagging, Lemmatization and Dependency Parsing Based on the UDPipe Natural Language Processing Toolkit](https://github.com/bnosac/udpipe)
- [quanteda/spacyr: R wrapper to spaCy NLP](https://github.com/quanteda/spacyr)

æœ€è¿‘ã«ãªã£ã¦bnosacã‹ã‚‰BPEï¼ˆByte Pair Encodingï¼‰ã¨sentencepieceã®Rãƒ©ãƒƒãƒ‘ãƒ¼ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚

- [bnosac/tokenizers.bpe: R package for Byte Pair Encoding based on YouTokenToMe](https://github.com/bnosac/tokenizers.bpe)
- [bnosac/sentencepiece: R package for Byte Pair Encoding / Unigram modelling based on Sentencepiece](https://github.com/bnosac/sentencepiece)

### Language Representations

ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«é–‹ç™ºã•ã‚Œã¦ã„ãã†ãªã‚‚ã®ã¨ã—ã¦ã€ã“ã®ã‚ãŸã‚Šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã™ã€‚

- [dselivanov/text2vec: Fast vectorization, topic modeling, distances and GloVe word embeddings in R.](https://github.com/dselivanov/text2vec)
- [pommedeterresautee/fastrtext: R wrapper for fastText](https://github.com/pommedeterresautee/fastrtext)
- [bnosac/ruimtehol: R package to Embed All the Things! using StarSpace](https://github.com/bnosac/ruimtehol)
- [bnosac/doc2vec: Distributed Representations of Sentences and Documents](https://github.com/bnosac/doc2vec)
- [bnosac/golgotha: Contextualised Embeddings and Language Modelling using BERT and Friends using R](https://github.com/bnosac/golgotha)
- [jonathanbratt/RBERT: Implementation of BERT in R](https://github.com/jonathanbratt/RBERT)

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—


```r
suppressWarnings({
  library("tidymodels")
  library("textrecipes")
  library("tokenizers.bpe")
  library("zipangu") ## uribo/zipangu
  library("fastrtext") ## pommedeterresautee/fastrtext
  library("RcppMeCab") ## paithiov909/RcppMeCab
  library("ldccr") ## paithiov909/ldccr
  # ä»¥ä¸‹ã€ãã®ä»–ã«å¿…è¦ãªã‚„ã¤
  requireNamespace("text2vec")
  requireNamespace("xgboost")
})
#> Registered S3 method overwritten by 'tune':
#>   method                   from   
#>   required_pkgs.model_spec parsnip
#> â”€â”€ Attaching packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidymodels 0.1.3 â”€â”€
#> âœ” broom        0.7.9      âœ” recipes      0.1.16
#> âœ” dials        0.0.9      âœ” rsample      0.1.0 
#> âœ” dplyr        1.0.7      âœ” tibble       3.1.4 
#> âœ” ggplot2      3.3.5      âœ” tidyr        1.1.3 
#> âœ” infer        1.0.0      âœ” tune         0.1.6 
#> âœ” modeldata    0.1.1      âœ” workflows    0.2.3 
#> âœ” parsnip      0.1.7      âœ” workflowsets 0.1.0 
#> âœ” purrr        0.3.4      âœ” yardstick    0.0.8
#> â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidymodels_conflicts() â”€â”€
#> âœ– purrr::discard() masks scales::discard()
#> âœ– dplyr::filter()  masks stats::filter()
#> âœ– dplyr::lag()     masks stats::lag()
#> âœ– recipes::step()  masks stats::step()
#> â€¢ Use tidymodels_prefer() to resolve common conflicts.
#> 
#> Attaching package: 'RcppMeCab'
#> The following object is masked from 'package:tidyr':
#> 
#>     pack
#> Loading required namespace: text2vec
#> Loading required namespace: xgboost
```

## ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™

[livedoorãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‘ã‚¹](https://www.rondhuit.com/download.html#ldcc)ã‚’ä½¿ã„ã¾ã™ã€‚ä»¥ä¸‹ã®9ã‚«ãƒ†ã‚´ãƒªã§ã™ã€‚

- ãƒˆãƒ”ãƒƒã‚¯ãƒ‹ãƒ¥ãƒ¼ã‚¹
- Sports Watch
- ITãƒ©ã‚¤ãƒ•ãƒãƒƒã‚¯
- å®¶é›»ãƒãƒ£ãƒ³ãƒãƒ«
- MOVIE ENTER
- ç‹¬å¥³é€šä¿¡
- ã‚¨ã‚¹ãƒãƒƒã‚¯ã‚¹
- livedoor HOMME
- Peachy

[ãƒ‘ãƒ¼ã‚µã‚’æ›¸ã„ãŸ](https://github.com/paithiov909/ldccr)ã®ã§ã€ãã‚Œã§ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã«ã—ã¾ã™ã€‚


```r
data <- ldccr::parse_ldcc()
#> Parsing dokujo-tsushin...
#> Parsing it-life-hack...
#> Parsing kaden-channel...
#> Parsing livedoor-homme...
#> Parsing movie-enter...
#> Parsing peachy...
#> Parsing smax...
#> Parsing sports-watch...
#> Parsing topic-news...
#> Done.
```

ã“ã®è¨˜äº‹ã‚’æ›¸ã„ãŸå½“åˆã¯RcppMeCab + Neologdã§ã®å½¢æ…‹ç´ è§£æã‚’è©¦ãã†ã¨ã—ã¦ä¸Šæ‰‹ãã„ã‹ãšã€rjavacmecabã¨ã„ã†è‡ªä½œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ä»£ç”¨ã—ã¦ã„ã¾ã—ãŸï¼ˆå‹•ãã‘ã©éå¸¸ã«é…ã„ï¼‰ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚

``` r
corpus_mecab <- data %>%
  dplyr::sample_frac(.01) %>%
  dplyr::mutate(category = as.factor(category)) %>%
  dplyr::mutate(body = normalize(body)) %>%
  tibble::rowid_to_column()

corpus_mecab <- corpus_mecab %>%
  dplyr::group_by(rowid) %>%
  dplyr::group_map(~
  .x$body %>%
    rjavacmecab::cmecab(sep = "\t") %>%
    rjavacmecab::prettify(sep = "\t") %>%
    dplyr::pull(Original) %>%
    paste(collapse = " ")) %>%
  purrr::map_dfr(~ tibble::tibble(tokens = .)) %>%
  dplyr::bind_cols(corpus_mecab)
```

ãã®å¾Œã€RcppMeCabã‚’ä½¿ã†å ´åˆã«ã¯æ¬¡ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã§ãã‚‹ã®ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚ãŸã ã—ã€2021å¹´1æœˆç¾åœ¨CRANã«ã‚ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆ0.0.1.2ï¼‰ã¯æœªçŸ¥èªã®å‡¦ç†ã«ãƒã‚°ãŒã‚ã‚‹ã‚ˆã†ãªã®ã§ã€ã“ã“ã§ã¯[ã‚½ãƒ¼ã‚¹ã‚’ä¿®æ­£ã—ãŸã‚‚ã®](https://github.com/paithiov909/RcppMeCab)ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚


```r
corpus_mecab <- data %>%
  dplyr::select(-file_path) %>%
  dplyr::mutate(category = as.factor(category)) %>%
  dplyr::mutate(body = zipangu::str_jnormalize(body)) %>%
  tibble::rowid_to_column()

corpus_mecab <- corpus_mecab %>%
  dplyr::pull(body) %>%
  RcppMeCab::posParallel(format = "data.frame") %>%
  RcppMeCab::pack() %>%
  dplyr::left_join(corpus_mecab, by = c("doc_id" = "rowid"))
```

tokenizer.bpeã§ã‚µãƒ–ãƒ¯ãƒ¼ãƒ‰åˆ†å‰²ã™ã‚‹å ´åˆã€‚


```r
corpus_bpe <- data %>%
  dplyr::select(-file_path) %>%
  dplyr::mutate(category = as.factor(category)) %>%
  dplyr::mutate(body = zipangu::str_jnormalize(body)) %>%
  tibble::rowid_to_column()

token_model <- data %>%
  dplyr::pull(body) %>%
  tokenizers.bpe::bpe(vocab_size = 5000) ## equal to default

corpus_bpe <- corpus_bpe %>%
  dplyr::pull(body) %>%
  purrr::map(
    ~ tokenizers.bpe::bpe_encode(token_model, x = ., type = "subword")
  ) %>%
  purrr::flatten() %>%
  purrr::map_dfr(~ tibble(text = paste(., collapse = " "))) %>%
  dplyr::bind_cols(corpus_bpe)
```

ã“ã†ã„ã†ãƒ‡ãƒ¼ã‚¿ã«ãªã‚Šã¾ã™ã€‚


```r
corpus <- list(mecab = corpus_mecab, bpe = corpus_bpe) %>%
  purrr::walk(~ dplyr::glimpse(.)) %>%
  purrr::map(~ rsample::initial_split(., prop = .8))
#> Rows: 7,367
#> Columns: 6
#> $ doc_id     <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, â€¦
#> $ text       <chr> "å‹äºº ä»£è¡¨ ã® ã‚¹ãƒ”ãƒ¼ãƒ ã€ ç‹¬å¥³ ã¯ ã©ã† ã“ãªã— ã¦ ã„ã‚‹ ? ã‚‚â€¦
#> $ category   <fct> dokujo-tsushin, dokujo-tsushin, dokujo-tsushin, dokujo-tsusâ€¦
#> $ source     <chr> "http://news.livedoor.com/article/detail/4778030/", "http:/â€¦
#> $ time_stamp <chr> "2010-05-22T14:30:00+0900", "2010-05-21T14:30:00+0900", "20â€¦
#> $ body       <chr> "å‹äººä»£è¡¨ã®ã‚¹ãƒ”ãƒ¼ãƒã€ç‹¬å¥³ã¯ã©ã†ã“ãªã—ã¦ã„ã‚‹?ã‚‚ã†ã™ãã‚¸ãƒ¥ãƒ¼â€¦
#> Rows: 7,367
#> Columns: 6
#> $ text       <chr> "â– å‹ äºº ä»£è¡¨ ã® ã‚¹ãƒ” ãƒ¼ ãƒ ã€ ç‹¬å¥³ ã¯ã©ã† ã“ ãª ã—ã¦ã„ã‚‹ ?â€¦
#> $ rowid      <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, â€¦
#> $ category   <fct> dokujo-tsushin, dokujo-tsushin, dokujo-tsushin, dokujo-tsusâ€¦
#> $ source     <chr> "http://news.livedoor.com/article/detail/4778030/", "http:/â€¦
#> $ time_stamp <chr> "2010-05-22T14:30:00+0900", "2010-05-21T14:30:00+0900", "20â€¦
#> $ body       <chr> "å‹äººä»£è¡¨ã®ã‚¹ãƒ”ãƒ¼ãƒã€ç‹¬å¥³ã¯ã©ã†ã“ãªã—ã¦ã„ã‚‹?ã‚‚ã†ã™ãã‚¸ãƒ¥ãƒ¼â€¦
```

## ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ï¼‘ï¼ˆFeatureHashingï¼‰

æ¬¡ã®ã‚ˆã†ãªé–¢æ•°ã§ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã—ã¾ã™ã€‚


```r
prep_corpus <- function(corpus, recipe) {
  train <- recipe %>%
    recipes::juice()
  test <- recipe %>%
    recipes::bake(rsample::testing(corpus))

  return(list(train = train, test = test))
}
```

ä»¥ä¸‹ã®ãƒ¬ã‚·ãƒ”ã¨ãƒ¢ãƒ‡ãƒ«ã§å­¦ç¿’ã—ã¾ã™ã€‚ãƒãƒƒã‚·ãƒ¥ãƒˆãƒªãƒƒã‚¯ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯[ã“ã“ã«æ›¸ã„ã¦ã„ã‚‹æ„Ÿã˜](https://parsnip.tidymodels.org/reference/boost_tree.html)ã«ãªã‚Šã¾ã™ã€‚


```r
model <- parsnip::boost_tree() %>%
  parsnip::set_engine("xgboost") %>%
  parsnip::set_mode("classification") %>%
  parsnip::translate()

fit_corpus <- function(corpus, model) {
  recipe <- recipes::recipe(
    category ~ text,
    data = rsample::training(corpus)
  ) %>%
    textrecipes::step_tokenize(text) %>%
    textrecipes::step_texthash(text) %>%
    recipes::prep()

  split <- prep_corpus(corpus, recipe)

  fitted <- model %>%
    parsnip::fit(category ~ ., data = split$train)

  fitted %>%
    predict(split$test) %>%
    dplyr::bind_cols(split$test) %>%
    yardstick::metrics(truth = category, estimate = .pred_class) %>%
    print()
}

print(model)
#> Boosted Tree Model Specification (classification)
#> 
#> Computational engine: xgboost 
#> 
#> Model fit template:
#> parsnip::xgb_train(x = missing_arg(), y = missing_arg(), nthread = 1, 
#>     verbose = 0)
```

`fit`ã—ã¦ã€ç²¾åº¦ã‚’ã¿ã¦ã¿ã¾ã™ã€‚


```r
purrr::walk(corpus, ~ fit_corpus(., model))
#> [11:11:00] WARNING: amalgamation/../src/learner.cc:1095: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective 'multi:softprob' was changed from 'merror' to 'mlogloss'. Explicitly set eval_metric if you'd like to restore the old behavior.
#> # A tibble: 2 Ã— 3
#>   .metric  .estimator .estimate
#>   <chr>    <chr>          <dbl>
#> 1 accuracy multiclass     0.897
#> 2 kap      multiclass     0.884
#> [11:11:36] WARNING: amalgamation/../src/learner.cc:1095: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective 'multi:softprob' was changed from 'merror' to 'mlogloss'. Explicitly set eval_metric if you'd like to restore the old behavior.
#> # A tibble: 2 Ã— 3
#>   .metric  .estimator .estimate
#>   <chr>    <chr>          <dbl>
#> 1 accuracy multiclass     0.895
#> 2 kap      multiclass     0.881
```

## ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ï¼’ï¼ˆfasttextï¼‰

BPEã§ã‚µãƒ–ãƒ¯ãƒ¼ãƒ‰åˆ†å‰²ã—ãŸæ–‡æ›¸ã«ã¤ã„ã¦ã€fasttextã§åŸ‹ã‚è¾¼ã¿ã‚’å¾—ã¦ã‹ã‚‰å­¦ç¿’ã—ã¦ã¿ã¾ã™ã€‚ã‚ãã¾ã§è©¦ã—ã¦ã¿ã‚‹ç›®çš„ã®ãŸã‚ã€ã“ã“ã§ã¯50æ¬¡å…ƒã®ãƒ™ã‚¯ãƒˆãƒ«ã«ã—ã¾ã™ã€‚


```r
temp <- tempfile(fileext = ".txt")
readr::write_lines(
  corpus_bpe$text,
  file = temp
)
fastrtext::execute(c("skipgram", "-input", temp, "-output", "model", "-dim", 50L))
#> 
Read 1M words
Read 2M words
Read 3M words
Read 4M words
Read 5M words
Read 5M words
#> Number of words:  4686
#> Number of labels: 0
#> 
#### ã¨ãã«suppressã—ãªã„ã‹ãã‚Šã€ã“ã“ã‹ã‚‰ä¸‹ã«å­¦ç¿’çŠ¶æ³ãŒãšã‚‰ãƒ¼ã£ã¨ãƒ—ãƒªãƒ³ãƒˆã•ã‚Œã‚‹ ####
```

ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿ã€‚


```r
ft_model <- fastrtext::load_model("model.bin")
```

ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã«æ•´å½¢ã—ã¾ã™ã€‚


```r
vocab <- fastrtext::get_dictionary(ft_model)
Encoding(vocab) <- "UTF-8" ## For Windows machine
embeddings <- ft_model %>%
  fastrtext::get_word_vectors(vocab) %>%
  as.data.frame() %>%
  dplyr::bind_cols(tibble::tibble(vocab = vocab)) %>%
  dplyr::select(vocab, everything())

remove(ft_model)
```

ä»Šåº¦ã¯æ¬¡ã®ã‚ˆã†ãªãƒ¬ã‚·ãƒ”ã§å­¦ç¿’ã—ã¾ã™ã€‚ä¸Šã§ã‚„ã£ãŸã®ã¨åŒã˜ã‚ˆã†ã«ç´ ç›´ã«ã‚„ã‚ã†ã¨ã™ã‚‹ã¨æ‰‹å…ƒã®ç’°å¢ƒã§ã¯ãƒ¡ãƒ¢ãƒªãŒè¶³ã‚Šãªã‹ã£ãŸã®ã§ã€ã“ã“ã§ã¯`textrecipes::step_tokenfilter`ã§èªå½™ã‚’å‰Šã£ã¦ã„ã¾ã™ã€‚


```r
fit_corpus_b <- function(corpus, model) {
  recipe <- recipes::recipe(
    category ~ text,
    data = rsample::training(corpus)
  ) %>%
    textrecipes::step_tokenize(text) %>%
    textrecipes::step_tokenfilter(text, min_times = 3L, max_tokens = 50L) %>%
    textrecipes::step_word_embeddings(
      text,
      embeddings = tibble::as_tibble(embeddings)
    ) %>%
    recipes::prep()

  split <- prep_corpus(corpus, recipe)

  fitted <- model %>%
    parsnip::fit(category ~ ., data = split$train)

  fitted %>%
    predict(split$test) %>%
    dplyr::bind_cols(split$test) %>%
    yardstick::metrics(truth = category, estimate = .pred_class) %>%
    print()
}
```

`fit`ã—ã¾ã™ï¼ˆãªã‚“ã‹æ€ã£ãŸã»ã©ç²¾åº¦ãŒã‚ˆããªã„ã®ã§ã©ã“ã‹é–“é•ã£ã¦ã„ã‚‹ã®ã‹ã‚‚ã—ã‚Œãªã„ï¼‰ã€‚




```r
fit_corpus_b(corpus$bpe, model)
#> [11:14:22] WARNING: amalgamation/../src/learner.cc:1095: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective 'multi:softprob' was changed from 'merror' to 'mlogloss'. Explicitly set eval_metric if you'd like to restore the old behavior.
#> # A tibble: 2 Ã— 3
#>   .metric  .estimator .estimate
#>   <chr>    <chr>          <dbl>
#> 1 accuracy multiclass     0.599
#> 2 kap      multiclass     0.547
```

## æ‰€æ„Ÿ

livedoorãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‘ã‚¹ã¯ãã‚“ãªã«å¤§ããªã‚³ãƒ¼ãƒ‘ã‚¹ã˜ã‚ƒãªã„ã®ã§ã‚µã‚¯ãƒƒã¨ã§ãã¦ã»ã—ã„ã®ã§ã™ãŒã€textrecipesã§åŸ‹ã‚è¾¼ã¿ã‚’æ‰±ã†ã«ã¯æ‰‹å…ƒã®ç’°å¢ƒã§ã¯ä¸è¶³ãªã‚ˆã†ã§ã—ãŸï¼ˆãŸã¶ã‚“ç§ãŒä½¿ã£ã¦ã„ã‚‹PCãŒå¤ã„ã ã‘ã§ã™ãŒï¼‰ã€‚

ã“ã®ã‚³ãƒ¼ãƒ‘ã‚¹ã®ã‚«ãƒ†ã‚´ãƒªåˆ†é¡ã¯ã‹ãªã‚Šæ˜“ã—ã„ã‚¿ã‚¹ã‚¯ã§ã‚ã‚‹ã“ã¨ãŒçŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ï¼ˆã¨ã„ã†ã‹ã€ä¸€éƒ¨ã®ã‚«ãƒ†ã‚´ãƒªã§ã¯ãã®ã‚«ãƒ†ã‚´ãƒªã‚’åŒå®šã§ãã‚‹å˜èªãŒæœ¬æ–‡ã«å«ã¾ã‚Œã¦ã—ã¾ã£ã¦ã„ã‚‹ï¼‰ã®ã§ç›¸æ€§ã‚‚ã‚ã‚‹ã®ã§ã—ã‚‡ã†ãŒã€ãƒãƒƒã‚·ãƒ¥ãƒˆãƒªãƒƒã‚¯ã—ã¦XGBoostã«æŠ•å…¥ã™ã‚‹ã ã‘ã§ç°¡å˜ã«ã‚ˆã„ç²¾åº¦ã®äºˆæ¸¬ãŒã§ãã‚‹ç‚¹ã¯æ°—æŒã¡ã‚ˆã„ã§ã™ã€‚bnosac/sentencepieceã‚‚tokenizer.bpeã¨åŒã˜ãƒãƒªã§ä½¿ãˆã‚‹ã‚ˆã†ãªã®ã§ã€ã‚µãƒ–ãƒ¯ãƒ¼ãƒ‰åˆ†å‰²ã§ã‚ˆã‘ã‚Œã°Rã§ã‚‚ç°¡å˜ã«ã§ãã‚‹ã¨ã‚ã‹ã‚Šã¾ã—ãŸã€‚

ä¸€æ–¹ã§ã€RcppMeCabã¯ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã¾ã§ãŒä¾ç„¶ã¨ã—ã¦ã‚ã‚“ã©ãã•ã„ã¨ã„ã†ã“ã¨ã‚‚ã‚ã‚Šã€åˆ†ã‹ã¡æ›¸ãã™ã‚‹ã ã‘ãªã‚‰ã»ã‹ã®æ‰‹æ®µã®ã»ã†ãŒç°¡å˜ãªæ°—ãŒã—ã¾ã™ã€‚

## ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±


```r
sessioninfo::session_info()
#> â”€ Session info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#>  setting  value                       
#>  version  R version 4.1.1 (2021-08-10)
#>  os       Ubuntu 20.04.2 LTS          
#>  system   x86_64, linux-gnu           
#>  ui       X11                         
#>  language (EN)                        
#>  collate  C.UTF-8                     
#>  ctype    C.UTF-8                     
#>  tz       UTC                         
#>  date     2021-08-31                  
#> 
#> â”€ Packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#>  ! package        * version     date       lib
#>  P assertthat       0.2.1       2019-03-21 [?]
#>  P backports        1.2.1       2020-12-09 [?]
#>  P bit              4.0.4       2020-08-04 [?]
#>  P bit64            4.0.5       2020-08-30 [?]
#>  P broom          * 0.7.9       2021-07-27 [?]
#>  P cachem           1.0.6       2021-08-19 [?]
#>  P class            7.3-19      2021-05-03 [?]
#>  P cli              3.0.1       2021-07-17 [?]
#>  P codetools        0.2-16      2018-12-24 [?]
#>  P colorspace       2.0-2       2021-06-24 [?]
#>  P crayon           1.4.1       2021-02-08 [?]
#>  P data.table       1.14.0      2021-02-21 [?]
#>  P dials          * 0.0.9       2020-09-16 [?]
#>  P DiceDesign       1.9         2021-02-13 [?]
#>  P digest           0.6.27      2020-10-24 [?]
#>  P dplyr          * 1.0.7       2021-06-18 [?]
#>  P ellipsis         0.3.2       2021-04-29 [?]
#>  P evaluate         0.14        2019-05-28 [?]
#>  P fansi            0.5.0       2021-05-25 [?]
#>  P fastmap          1.1.0       2021-01-25 [?]
#>  P fastrtext      * 0.3.4       2021-08-31 [?]
#>  P float            0.2-4       2020-04-22 [?]
#>  P foreach          1.5.1       2020-10-15 [?]
#>  P furrr            0.2.3       2021-06-25 [?]
#>  P future           1.22.1      2021-08-25 [?]
#>  P generics         0.1.0       2020-10-31 [?]
#>  P ggplot2        * 3.3.5       2021-06-25 [?]
#>  P globals          0.14.0      2020-11-22 [?]
#>  P glue             1.4.2       2020-08-27 [?]
#>  P gower            0.2.2       2020-06-23 [?]
#>  P GPfit            1.0-8       2019-02-08 [?]
#>  P gtable           0.3.0       2019-03-25 [?]
#>  P hardhat          0.1.6       2021-07-14 [?]
#>  P hms              1.1.0       2021-05-17 [?]
#>  P htmltools        0.5.2       2021-08-25 [?]
#>  P infer          * 1.0.0       2021-08-13 [?]
#>  P ipred            0.9-11      2021-03-12 [?]
#>  P iterators        1.0.13      2020-10-15 [?]
#>  P jsonlite         1.7.2       2020-12-09 [?]
#>  P knitr            1.33        2021-04-24 [?]
#>  P lattice          0.20-44     2021-05-02 [?]
#>  P lava             1.6.9       2021-03-11 [?]
#>  P ldccr          * 0.0.6       2021-08-31 [?]
#>  P lgr              0.4.2       2021-01-10 [?]
#>  P lhs              1.1.1       2020-10-05 [?]
#>  P lifecycle        1.0.0       2021-02-15 [?]
#>  P listenv          0.8.0       2019-12-05 [?]
#>  P lubridate        1.7.10      2021-02-26 [?]
#>  P magrittr         2.0.1       2020-11-17 [?]
#>  P MASS             7.3-54      2021-05-03 [?]
#>  P Matrix           1.3-4       2021-06-01 [?]
#>  P memoise          2.0.0       2021-01-26 [?]
#>  P mlapi            0.1.0       2017-12-17 [?]
#>  P modeldata      * 0.1.1       2021-07-14 [?]
#>  P munsell          0.5.0       2018-06-12 [?]
#>  P nnet             7.3-16      2021-05-03 [?]
#>  P parallelly       1.27.0      2021-07-19 [?]
#>  P parsnip        * 0.1.7       2021-07-21 [?]
#>  P pillar           1.6.2       2021-07-29 [?]
#>  P pkgconfig        2.0.3       2019-09-22 [?]
#>  P plyr             1.8.6       2020-03-03 [?]
#>  P pROC             1.17.0.1    2021-01-13 [?]
#>  P prodlim          2019.11.13  2019-11-17 [?]
#>  P purrr          * 0.3.4       2020-04-17 [?]
#>  P R.cache          0.15.0      2021-04-30 [?]
#>  P R.methodsS3      1.8.1       2020-08-26 [?]
#>  P R.oo             1.24.0      2020-08-26 [?]
#>  P R.utils          2.10.1      2020-08-26 [?]
#>  P R6               2.5.1       2021-08-19 [?]
#>  P Rcpp             1.0.7       2021-07-07 [?]
#>  P RcppMeCab      * 0.0.1.3.900 2021-08-31 [?]
#>  P RcppParallel     5.1.4       2021-05-04 [?]
#>  P readr            2.0.1       2021-08-10 [?]
#>  P recipes        * 0.1.16      2021-04-16 [?]
#>  P rematch2         2.1.2       2020-05-01 [?]
#>  P renv             0.14.0      2021-07-21 [?]
#>  P RhpcBLASctl      0.20-137    2020-05-17 [?]
#>  P rlang            0.4.11      2021-04-30 [?]
#>  P rmarkdown        2.10        2021-08-06 [?]
#>  P rpart            4.1-15      2019-04-12 [?]
#>  P rsample        * 0.1.0       2021-05-08 [?]
#>  P rsparse          0.4.0       2020-04-01 [?]
#>  P rstudioapi       0.13        2020-11-12 [?]
#>  P scales         * 1.1.1       2020-05-11 [?]
#>  P sessioninfo      1.1.1       2018-11-05 [?]
#>  P SnowballC        0.7.0       2020-04-01 [?]
#>  P stringi          1.7.4       2021-08-25 [?]
#>  P stringr          1.4.0       2019-02-10 [?]
#>  P styler           1.5.1       2021-07-13 [?]
#>  P survival         3.2-13      2021-08-24 [?]
#>  P text2vec         0.6         2020-02-18 [?]
#>  P textrecipes    * 0.4.1       2021-07-11 [?]
#>  P tibble         * 3.1.4       2021-08-25 [?]
#>  P tidymodels     * 0.1.3       2021-04-19 [?]
#>  P tidyr          * 1.1.3       2021-03-03 [?]
#>  P tidyselect       1.1.1       2021-04-30 [?]
#>  P timeDate         3043.102    2018-02-21 [?]
#>  P tokenizers       0.2.1       2018-03-29 [?]
#>  P tokenizers.bpe * 0.1.0       2019-08-02 [?]
#>  P tune           * 0.1.6       2021-07-21 [?]
#>  P tzdb             0.1.2       2021-07-20 [?]
#>  P utf8             1.2.2       2021-07-24 [?]
#>  P vctrs            0.3.8       2021-04-29 [?]
#>  P vroom            1.5.4       2021-08-05 [?]
#>  P withr            2.4.2       2021-04-18 [?]
#>  P workflows      * 0.2.3       2021-07-16 [?]
#>  P workflowsets   * 0.1.0       2021-07-22 [?]
#>  P xfun             0.25        2021-08-06 [?]
#>  P xgboost          1.4.1.1     2021-04-22 [?]
#>  P yaml             2.2.1       2020-02-01 [?]
#>  P yardstick      * 0.0.8       2021-03-28 [?]
#>  P zipangu        * 0.2.3.9000  2021-08-31 [?]
#>  source                                       
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  Github (pommedeterresautee/fastrtext@b63c5de)
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  Github (paithiov909/ldccr@5907848)           
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  Github (paithiov909/RcppMeCab@208f1de)       
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  CRAN (R 4.1.1)                               
#>  Github (uribo/zipangu@316afb3)               
#> 
#> [1] /home/runner/work/nlp-using-r/nlp-using-r/renv/library/R-4.1/x86_64-pc-linux-gnu
#> [2] /tmp/RtmpeC5aar/renv-system-library
#> 
#>  P â”€â”€ Loaded and on-disk path mismatch.
```

