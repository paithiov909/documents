---
ID: dbe42d0fa5565fa2519c
Title: Rで短歌のテキストマイニング
Tags: R,テキストマイニング
Author: Kato Akiru
Private: false
---

## この記事について

以前に公開した記事を移動してきたものです。所感は[こちら](https://note.com/shinabitanori/n/nf19cfadb06bc)。

## ファイルの読み込み

自作短歌のテキストを読み込んで前処理しておきます。

```r
normalize <- function(str) {
  str %>%
    stringr::str_replace_all("\u2019", "\'") %>%
    stringr::str_replace_all("\u201d", "\"") %>%
    stringr::str_replace_all("[\u02d7\u058a\u2010\u2011\u2012\u2013\u2043\u207b\u208b\u2212]", "-") %>%
    stringr::str_replace_all("[\ufe63\uff0d\uff70\u2014\u2015\u2500\u2501\u30fc]", enc2utf8("\u30fc")) %>%
    stringr::str_replace_all("[~\u223c\u223e\u301c\u3030\uff5e]", "~") %>%
    stringr::str_remove_all("[:punct:]") %>%
    stringr::str_remove_all("[:blank:]") %>%
    stringr::str_remove_all("[:cntrl:]") %>%
    return()
}

csv <- readr::read_csv("https://bit.ly/2ye2pT6") %>%
  dplyr::mutate(normalized = normalize(body)) %>%
  dplyr::select(id, normalized)
#> Parsed with column specification:
#> cols(
#>   id = col_double(),
#>   body = col_character()
#> )

nrow(csv)
#> [1] 436
```

## 形態素解析

形態素解析の手段はなんでもよいのですが、今回は[この自作パッケージ](https://github.com/paithiov909/tangela)を使います。このパッケージは[atilika/kuromoji](https://github.com/atilika/kuromoji)をrJava経由で呼べるようにしたもので、形態素解析をおこなう関数`tangela::kuromoji`のみを提供するシンプルなものです。

文字列はUTF-8として渡す前提で、戻り値のテキストのエンコーディングもUTF-8になります。


```r
parseKuromoji <- function(str) {
  res <- tangela::kuromoji(str)
  res %>%
    purrr::imap_dfr(~
    data.frame(
      mid = .y,
      Surface = .x$surface,
      feature = .x$feature,
      is_unk = .x$is_unk,
      stringsAsFactors = FALSE
    ) %>%
      tidyr::separate(feature, into = c(
        "POS1",
        "POS2",
        "POS3",
        "POS4",
        "X5StageUse1",
        "X5StageUse2",
        "Original",
        "Yomi1",
        "Yomi2"
      ), sep = ",", fill = "right"))
}

res <- csv$normalized %>%
  imap_dfr(function(str, idx) {
    cols <- parseKuromoji(str)
    dplyr::bind_cols(
      data.frame(id = rep(idx, nrow(cols))),
      cols
    )
  }) %>%
  dplyr::mutate(mora = dplyr::if_else(
    .data$is_unk == TRUE,
    nchar(.data$Surface),
    nchar(stringr::str_remove_all(.data$Yomi2, "[\u30e3\u30e5\u30e7]"))
  )) %>%
  tibble::rowid_to_column()

head(res)
#>   rowid id mid  Surface POS1     POS2 POS3 POS4 X5StageUse1 X5StageUse2
#> 1     1  1   1 ぐるぐる 副詞     一般    *    *           *           *
#> 2     2  1   2       と 助詞   副詞化    *    *           *           *
#> 3     3  1   3     山手 名詞 固有名詞 地域 一般           *           *
#> 4     4  1   4       線 名詞     接尾 一般    *           *           *
#> 5     5  1   5       は 助詞   係助詞    *    *           *           *
#> 6     6  1   6   ループ 名詞     一般    *    *           *           *
#>   Original    Yomi1    Yomi2 is_unk mora
#> 1 ぐるぐる グルグル グルグル  FALSE    4
#> 2       と       ト       ト  FALSE    1
#> 3     山手   ヤマテ   ヤマテ  FALSE    3
#> 4       線     セン     セン  FALSE    2
#> 5       は       ハ       ワ  FALSE    1
#> 6   ループ   ループ   ループ  FALSE    3
```

## 語彙の集計（１）

簡単に語彙の集計をしてみます。{RMeCab}を使わずに手軽に単語文書行列（Document Term Matrix）を作成する方法はいくつかありますが、ここではまずはじめに{textmineR}を使ってみます。文書を文字列ベクトルとして`textmineR::CreateDtm`に渡すだけです。

`textmineR::CreateDtm`に文書を渡すときにストップワードを指定できるので、指定してみています。日本語のストップワードはSlothlibなどが有名ですが、Rパッケージから利用できる面白いものとして、{rtweet}のデータセットである`stopwordslangs`があります。lang, word, pの３カラムからなるデータセットで、langとpでwordを絞り込んで使います。pは0~1の値で、1に近いほどよく使われる単語（英語だったら冠詞のaやtheみたいなやつ）になるみたいな感じです。狭い値の範囲にかなりの数の語彙があるので、p >= 0.98くらいで絞り込んでもふつうに使える気がします。



```r
stopwords <- rtweet::stopwordslangs %>%
  dplyr::filter(lang == "ja") %>%
  dplyr::filter(p >= .98) %>%
  dplyr::pull(word)

dtm <- textmineR::CreateDtm( ## この関数はそれなりに重いです
  res$Original,
  doc_names = res$id,
  ngram_window = c(1, 1),
  stopword_vec = stopwords
)
```

プロットしてみます。


```r
dtm %>%
  textmineR::TermDocFreq() %>%
  dplyr::arrange(desc(term_freq)) %>%
  head() %>%
  ggplot(aes(x = reorder(term, -doc_freq), y = doc_freq)) +
  geom_col() +
  labs(x = "word") +
  theme_light()
```

![unnamed-chunk-4-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/228173/125db65c-1408-5bd3-d5f0-9b30c9abd6e3.png)


## 語彙の集計（２）

単語文書行列を作ったり、文書を便利に扱う別の手段として{quanteda}を使ってみます。{quanteda}パッケージ内では、単語文書行列を含めて、文書に紐づく特徴量を格納した行列一般のことをDocument Feature Matrix（DFM）と呼んでいます。ここではDFMを作ってワードクラウドを描くまでやってみます。

{quanteda}では文書はコーパスというオブジェクトとして持ちます。ふつうに文字列ベクトルやデータフレームを渡して作成できます。


```r
corp <- res %>%
  dplyr::group_by(id) %>%
  dplyr::mutate(morphs = stringr::str_c(Surface, collapse = " ")) %>%
  dplyr::ungroup() %>%
  dplyr::select(id, morphs) %>%
  dplyr::distinct() %>%
  dplyr::right_join(csv, by = "id") %>%
  quanteda::corpus(docid_field = "id", text_field = "morphs")
#> Warning: NA is replaced by empty string

quanteda::ndoc(corp)
#> [1] 436
```

{quanteda}はコーパスに収めた各文書内での位置情報を保持しながら文書をトークン化して扱うことができます。トークン化は日本語を含めて{stringi}と内臓している辞書を用いてイイ感じにおこなってくれるので、新聞記事のようなさほど砕けていない文章ならトークナイザを用意しなくてもこのパッケージ単体でトークン化することができます（私は使ったことないですが、{spacyr}と連携してPOS taggingしたりといった使い方も想定しているらしいです）。ただ、今回は先にKuromojiで形態素解析をおこなっているので、単純な半角スペース区切りでトークン化するように`quanteda::tokens(what = "fastestword")`に渡します。

トークンオブジェクトは`quanteda::tokens_select`とそのショートハンドの関数でイイ感じに語彙を制限することができます。トークンオブジェクトを以下のようにパイプして、簡単にワードクラウドが描けます。


```r
dic <- res %>%
  dplyr::filter(POS1 == "名詞") %>%
  dplyr::pull(Surface)

toks <- quanteda::tokens(corp, what = "fastestword") %>%
  quanteda::tokens_keep(dic, valuetype = "fixed") %>%
  quanteda::tokens_remove(stopwords, valuetype = "fixed")

toks %>%
  quanteda::dfm() %>%
  quanteda::textplot_wordcloud(
    min_count = 2,
    random_order = FALSE,
    color = viridisLite::cividis(8)
  )
```

![unnamed-chunk-6-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/228173/77c820f0-eb79-96ec-d097-b07fb53e2891.png)


このプロット内にたぶん「玉」という語がありますが、ただの「玉」なんて単語が出てくるような覚えはありません。おそらく分かち書きに失敗している単語でしょう。詳細を見てみるためにコロケーションの一部を確認してみます。


```r
toks %>%
  quanteda::textstat_collocations(size = 2, min_count = 2) %>%
  as.data.frame(stringsAsFactors = FALSE)
#>                    collocation count count_nested length   lambda        z
#> 1                ロボット 篠原     3            0      2 7.387365 5.804044
#> 2                    ばい ばい     2            0      2 6.540068 5.398511
#> 3                        〇 〇     2            0      2 8.151429 4.654065
#> 4                  チョコ パイ     2            0      2 8.151429 4.654065
#> 5                    ハト 群れ     2            0      2 8.151429 4.654065
#> 6                    形状 新宿     2            0      2 8.151429 4.654065
#> 7                  しゃぼん 玉     2            0      2 7.639642 4.564775
#> 8                      山手 線     2            0      2 7.639642 4.564775
#> 9                        悠 木     2            0      2 7.639642 4.564775
#> 10               新宿 ドリアン     2            0      2 7.639642 4.564775
#> 11                   じん 今晩     2            0      2 9.251002 4.409761
#> 12                   ウー ロン     2            0      2 9.251002 4.409761
#> 13           サディ スティック     2            0      2 9.251002 4.409761
#> 14             スティック 形状     2            0      2 9.251002 4.409761
#> 15               ヌード ビーチ     2            0      2 9.251002 4.409761
#> 16                       木 碧     2            0      2 9.251002 4.409761
#> 17 木場 ステラウーパールーパー     2            0      2 9.251002 4.409761
#> 18                     洗濯 機     2            0      2 9.251002 4.409761
```

「悠木碧」とか「しゃぼん玉」とかが2語に分割されていることが確認できます。{quanteda}でこうした複数に分かれてしまったトークンをひとまとめに扱うには、次のようにします。


```r
multiwords <- c("悠 木 碧", "しゃぼん 玉", "山手 線", "洗濯 機", "サディ スティック")
toks %>%
  quanteda::tokens_compound(pattern = quanteda::phrase(multiwords)) %>%
  quanteda::kwic(c("悠_木_碧", "しゃぼん_玉"))
#>                                                      
#>  [122, 3]     ふゆ ふゆ | しゃぼん_玉 |              
#>  [126, 2]          髪型 |  悠_木_碧   | 悠_木_碧 眼力
#>  [126, 3] 髪型 悠_木_碧 |  悠_木_碧   | 眼力         
#>  [388, 1]               | しゃぼん_玉 | 便り 道具
```

もう一度ワードクラウドを描いてみました。


```r
toks %>%
  quanteda::tokens_compound(pattern = quanteda::phrase(multiwords)) %>%
  quanteda::dfm() %>%
  quanteda::textplot_wordcloud(
    min_count = 2,
    random_order = FALSE,
    color = viridisLite::cividis(8)
  )
```

![unnamed-chunk-9-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/228173/d75eff38-5f5a-c210-c363-ec8547c257b3.png)


## 「AのB」の出現位置

ここから本題です。名詞で助詞の「の」が挟まれている「AのB」のようなかたちの表現を探索して、こういった表現が短歌のどの部分に出現するかを概観したいと思います。

まず、「AのB」のようなかたちの表現を集めてみます。短歌は57577の定型詩で、音数（モーラ数）に注目すると便利なことがあるので、名詞はモーラ数に置き換えながら、このかたちの表現をマイニングします。


```r
a_b <- res %>%
  dplyr::filter(Surface == "の") %>%
  dplyr::pull(rowid) %>%
  purrr::keep(~ res$POS1[. - 1] == "名詞" & res$POS1[. + 1] == "名詞") %>%
  purrr::map_chr(~ stringr::str_c(
    res$mora[. - 1],
    res$Surface[.],
    res$mora[. + 1],
    collapse = ""
  )) %>%
  purrr::set_names(
    res %>%
      dplyr::filter(Surface == "の") %>%
      dplyr::pull(rowid) %>%
      purrr::keep(~ res$POS1[. - 1] == "名詞" & res$POS1[. + 1] == "名詞") %>%
      purrr::map_chr(~ stringr::str_c(
        res$Surface[. - 1],
        res$Surface[.],
        res$Surface[. + 1],
        collapse = ""
      ))
  )

head(a_b)
#>                 僕らの夢                 夢の末路             こどものまま 
#>                   "3の2"                   "2の3"                   "3の2" 
#> ここいらのツクツクボウシ           ゼリーのにおい         ものの成れの果て 
#>                   "4の7"                   "3の3"                   "2の5"
```

同じモーラ数の表現ごとにカウントして可視化してみます。


```r
res %>%
  dplyr::filter(Surface == "の") %>%
  dplyr::pull(rowid) %>%
  purrr::keep(~ res$POS1[. - 1] == "名詞" & res$POS1[. + 1] == "名詞") %>%
  purrr::map_chr(~ stringr::str_c(
    res$mora[. - 1],
    res$Surface[.],
    res$mora[. + 1],
    collapse = ""
  )) %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  dplyr::group_by_all() %>%
  dplyr::count() %>%
  dplyr::arrange(desc(n)) %>%
  head(15) %>%
  ggplot(aes(x = reorder(., -n), y = n)) +
  geom_col() +
  labs(x = "AのB") +
  theme_light()
```

![unnamed-chunk-11-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/228173/0632c5ca-500b-6ba7-241b-9c73c54bf88c.png)


「AのB」に相当する表現だけ「NのN」（Nはモーラ数）というかたちになるように分かち書きされた文字列ベクトルを作って、{quanteda}のコーパスに格納します。


```r
`%without%` <- purrr::negate(`%in%`)

idx <- res %>%
  dplyr::filter(Surface == "の") %>%
  dplyr::pull(rowid) %>%
  purrr::keep(~ res$POS1[. - 1] == "名詞" & res$POS1[. + 1] == "名詞")

corp <- idx %>%
  purrr::map_dfr(~
  data.frame(
    rowid = .,
    compound = stringr::str_c(
      res$mora[. - 1],
      res$Surface[.],
      res$mora[. + 1],
      collapse = ""
    ),
    stringsAsFactors = FALSE
  )) %>%
  dplyr::right_join(
    res %>%
      dplyr::filter(rowid %without% c(idx - 1, idx + 1)) %>%
      dplyr::mutate(compound = Surface),
    by = "rowid"
  ) %>%
  dplyr::group_by(id) %>%
  dplyr::mutate(morphs = stringr::str_c(
    dplyr::if_else(
      is.na(compound.x),
      compound.y,
      compound.x
    ),
    collapse = " "
  )) %>%
  dplyr::ungroup() %>%
  dplyr::select(id, morphs) %>%
  dplyr::distinct() %>%
  dplyr::right_join(csv, by = "id") %>%
  quanteda::corpus(docid_field = "id", text_field = "morphs")
#> Warning: NA is replaced by empty string

quanteda::ndoc(corp)
#> [1] 436
```

少しだけKWICで確認してみます。


```r
corp %>%
  quanteda::tokens(what = "fastestword") %>%
  quanteda::kwic(pattern = "[1-9]+の[0-9]+", valuetype = "regex") %>%
  head(30) %>%
  knitr::kable()
```



|docname | from| to|pre  |keyword |post                           |pattern        |
|:-------|----:|--:|:----|:-------|:------------------------------|:--------------|
|1       |    1|  1|     |3の2    |2の3 ぐるぐる と 山手 線       |[1-9]+の[0-9]+ |
|1       |    2|  2|3の2 |2の3    |ぐるぐる と 山手 線 は         |[1-9]+の[0-9]+ |
|2       |    1|  1|     |3の2    |いつ まで も で いる           |[1-9]+の[0-9]+ |
|3       |    1|  1|     |4の7    |は 律儀 に も ツクツクボウシ   |[1-9]+の[0-9]+ |
|6       |    1|  1|     |3の3    |なんで だ か 鼻腔 に           |[1-9]+の[0-9]+ |
|7       |    1|  1|     |2の5    |ヒマワリ と 呼ぶ べき 枯れ     |[1-9]+の[0-9]+ |
|9       |    1|  1|     |2の3    |3の4 今度 こそ ちゃんと 世界   |[1-9]+の[0-9]+ |
|9       |    2|  2|2の3 |3の4    |今度 こそ ちゃんと 世界 を     |[1-9]+の[0-9]+ |
|10      |    1|  1|     |3の2    |夏 という 夏 が 纏わり         |[1-9]+の[0-9]+ |
|11      |    1|  1|     |3の2    |あと すこし 経て ば 始発       |[1-9]+の[0-9]+ |
|17      |    1|  1|     |3の2    |3の3 コンビニ で は 買え       |[1-9]+の[0-9]+ |
|17      |    2|  2|3の2 |3の3    |コンビニ で は 買え なく       |[1-9]+の[0-9]+ |
|18      |    1|  1|     |4の2    |は タクラマカン 砂漠 とか まで |[1-9]+の[0-9]+ |
|21      |    1|  1|     |2の4    |2の3 が 新宿 三 丁目           |[1-9]+の[0-9]+ |
|21      |    2|  2|2の4 |2の3    |が 新宿 三 丁目 を             |[1-9]+の[0-9]+ |
|22      |    1|  1|     |2の2    |4の4 説明 しよ う くん         |[1-9]+の[0-9]+ |
|22      |    2|  2|2の2 |4の4    |説明 しよ う くん は           |[1-9]+の[0-9]+ |
|23      |    1|  1|     |4の4    |くん は 世界一 きれい な       |[1-9]+の[0-9]+ |
|25      |    1|  1|     |4の2    |を 曲がっ て ゆく 彼           |[1-9]+の[0-9]+ |
|27      |    1|  1|     |2の3    |不確か な こと 不確か な       |[1-9]+の[0-9]+ |
|29      |    1|  1|     |6の2    |2の4 たま しい と 呼び         |[1-9]+の[0-9]+ |
|29      |    2|  2|6の2 |2の4    |たま しい と 呼び うる         |[1-9]+の[0-9]+ |
|30      |    1|  1|     |2の3    |4の3 こう やっ て を           |[1-9]+の[0-9]+ |
|30      |    2|  2|2の3 |4の3    |こう やっ て を を             |[1-9]+の[0-9]+ |
|32      |    1|  1|     |4の4    |くん は また ひとつ ふわ       |[1-9]+の[0-9]+ |
|33      |    1|  1|     |2の3    |は ひとつ だけ ほど ほど       |[1-9]+の[0-9]+ |
|34      |    1|  1|     |3の2    |2の2 町 は もう 魔法           |[1-9]+の[0-9]+ |
|34      |    2|  2|3の2 |2の2    |町 は もう 魔法 大人           |[1-9]+の[0-9]+ |
|35      |    1|  1|     |2の2    |ミィ ちゃん は さ と           |[1-9]+の[0-9]+ |
|38      |    1|  1|     |4の2    |が たた ない それ だけ         |[1-9]+の[0-9]+ |

### 3の2

カウントが多かったものから順に、3の2から4の4まで、短歌のなかでの実際の位置を確認してみましょう。以下にあげる図の黒い線が引かれているあたりがその表現の各短歌内における出現箇所です。下図を見ると、3の2は三句と四句あたりが多そうだけど、わりとまんべんなくあるっぽいです。二句三句をまたぐようなあたりにはなさそう。


```r
toks <- corp %>%
  quanteda::tokens(what = "fastestword")
quanteda::textplot_xray(
  quanteda::kwic(toks, pattern = "3の2", valuetype = "regex")
)
```

![unnamed-chunk-14-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/228173/09194c77-0ccf-b675-50a4-dde710e1211f.png)



```r
a_b %>%
  purrr::keep(. == "3の2")
#>     僕らの夢 こどものまま   プールの後     今宵の僕     理想の恋     少女の夢 トイレのなか 
#>       "3の2"       "3の2"       "3の2"       "3の2"       "3の2"       "3の2"       "3の2" 
#>   凶器のよう コップのフチ       桜の花     吐息の泡   綿毛のよう   野山のよう   保身のため 
#>       "3の2"       "3の2"       "3の2"       "3の2"       "3の2"       "3の2"       "3の2" 
#>   詩人の戯画 ウンコのよう     遠くの海   少女のよう   昨日のこと サナギのよう     少女の髪 
#>       "3の2"       "3の2"       "3の2"       "3の2"       "3の2"       "3の2"       "3の2" 
#> みかんのすじ   文庫のなか   ホントの夜   あいつの頬 すすきのため   迷子のまま     魔界の塔 
#>       "3の2"       "3の2"       "3の2"       "3の2"       "3の2"       "3の2"       "3の2" 
#>     僕らの夢     私のため     阿吽の右 手つきのよう     私のせい   未明の意味   猫背のきみ 
#>       "3の2"       "3の2"       "3の2"       "3の2"       "3の2"       "3の2"       "3の2" 
#>   余韻のよう   香りのパン   邪神のたま キャベツの芯 
#>       "3の2"       "3の2"       "3の2"       "3の2"
```

### 2の3


```r
quanteda::textplot_xray(
  quanteda::kwic(toks, pattern = "2の3", valuetype = "regex")
)
```

![unnamed-chunk-16-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/228173/4d58d499-9e4f-ec6f-f575-422fc77cfa06.png)



```r
a_b %>%
  purrr::keep(. == "2の3")
#>       夢の末路   ためのレース       駅の付近       線の車体     ビルの谷間       彼の任務 
#>         "2の3"         "2の3"         "2の3"         "2の3"         "2の3"         "2の3" 
#>   はりのビール     味のポテチ     ずみの余生     鳥のことば       花の名前       夢の残滓 
#>         "2の3"         "2の3"         "2の3"         "2の3"         "2の3"         "2の3" 
#>     犬のウンコ       夏の記憶     夜のデネブ     貴女の夜会     汁のあさり     ための器官 
#>         "2の3"         "2の3"         "2の3"         "2の3"         "2の3"         "2の3" 
#>     たちの短歌       夏の祭り     ための土筆     猫のしっぽ   タブのかたち         親の力 
#>         "2の3"         "2の3"         "2の3"         "2の3"         "2の3"         "2の3" 
#>   しそのまんま     ボスの手前   たちのおでこ     ひとの小指 きょうのところ       恋の便り 
#>         "2の3"         "2の3"         "2の3"         "2の3"         "2の3"         "2の3" 
#>     げんの言語       冬の星座       量の放屁   旬のキャベツ 
#>         "2の3"         "2の3"         "2の3"         "2の3"
```

### 2の2


```r
quanteda::textplot_xray(
  quanteda::kwic(toks, pattern = "2の2", valuetype = "regex")
)
```

![unnamed-chunk-18-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/228173/7d764a36-aa46-a5d6-a7a2-36a7e7024de3.png)


```r
a_b %>%
  purrr::keep(. == "2の2")
#>     天の声   夢のなか   僕のもの     西の空     夏の風     春の夜 茶屋の富士     俺の横 
#>     "2の2"     "2の2"     "2の2"     "2の2"     "2の2"     "2の2"     "2の2"     "2の2" 
#>   どこの星   光のよう   頃のおれ   ための風   歳のとき   夏の果て   森のがん   森のなか 
#>     "2の2"     "2の2"     "2の2"     "2の2"     "2の2"     "2の2"     "2の2"     "2の2" 
#>     下の髭   沿いの海   色のロー   ほうの顔   鹿のフン     春の海     豆の味     JKの愛 
#>     "2の2"     "2の2"     "2の2"     "2の2"     "2の2"     "2の2"     "2の2"     "2の2" 
#>   積みの夜 ハトの群れ ハトの群れ 魔女のキキ   霊の祖父   街のどこ 
#>     "2の2"     "2の2"     "2の2"     "2の2"     "2の2"     "2の2"
```

### 4の3

明らかに偏りがあります。初句に多い。


```r
quanteda::textplot_xray(
  quanteda::kwic(toks, pattern = "4の3", valuetype = "fixed")
)
```

![unnamed-chunk-20-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/228173/a8c6e14d-22a7-e619-8b88-066373a4906d.png)



```r
a_b %>%
  purrr::keep(. == "4の3")
#>     ビックロの袋     全国のユカイ       青春の不在       八月の野球     前川の日焼け 
#>           "4の3"           "4の3"           "4の3"           "4の3"           "4の3" 
#>   たんぽぽの綿毛       深緑の野山 ドラゴンのうんこ     硝煙のにおい   グラビアの少女 
#>           "4の3"           "4の3"           "4の3"           "4の3"           "4の3" 
#>     春先のつがい レトルトのカレー       諸々の事情     風鈴のかたち アルパカの気持ち 
#>           "4の3"           "4の3"           "4の3"           "4の3"           "4の3" 
#>     常夏のイオン   あじさいの木陰       狛犬の阿吽     ロリータの頁     靴下の煮付け 
#>           "4の3"           "4の3"           "4の3"           "4の3"           "4の3" 
#>   ココイチの笑顔   あめんぼの吐息   マネキンの右手   メンヘラの思念       初恋の余韻 
#>           "4の3"           "4の3"           "4の3"           "4の3"           "4の3" 
#> シャンプーの香り       冬型の気圧     コリオリの力 
#>           "4の3"           "4の3"           "4の3"
```

### 4の2

やはり4モーラはじまりのためか初句が多いようす。


```r
quanteda::textplot_xray(
  quanteda::kwic(toks, pattern = "4の2", valuetype = "fixed")
)
```

![unnamed-chunk-22-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/228173/67cdac6f-d704-191e-9926-2b88fb01cf05.png)



```r
a_b %>%
  purrr::keep(. == "4の2")
#>         運命の人       伊勢丹の角     メレンゲの角         隆聖の声         体格の猫 
#>           "4の2"           "4の2"           "4の2"           "4の2"           "4の2" 
#>   メキシコのカン     思い出のメタ       朝焼けの空         噴水の水         我々の夏 
#>           "4の2"           "4の2"           "4の2"           "4の2"           "4の2" 
#>         東京の空         初恋の人         貝殻の中   じゃがいもの皮         大抵の敵 
#>           "4の2"           "4の2"           "4の2"           "4の2"           "4の2" 
#>         水性の青           唇の下         怪獣の一       白鳥の群れ       回送の文字 
#>           "4の2"           "4の2"           "4の2"           "4の2"           "4の2" 
#> いちじくのジャム       最愛のひと   しろくまのくせ         改札の前       恋愛のコツ 
#>           "4の2"           "4の2"           "4の2"           "4の2"           "4の2" 
#>       失恋のなみ 
#>           "4の2"
```

### 2の4

三句あたりが多い気がする。


```r
quanteda::textplot_xray(
  quanteda::kwic(toks, pattern = "2の4", valuetype = "fixed")
)
```

![unnamed-chunk-24-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/228173/51367699-8c7a-8998-762f-a8cbb9280baf.png)


```r
a_b %>%
  purrr::keep(. == "2の4")
#>         冬の足音         棚の最奥     色のハムカツ         状の物体   ためのポエジー 
#>           "2の4"           "2の4"           "2の4"           "2の4"           "2の4" 
#>   ときのかなしみ     性の生きもの     房のハバネロ         感の象徴   塔のミニチュア 
#>           "2の4"           "2の4"           "2の4"           "2の4"           "2の4" 
#>       色の足取り     奈良の春日野         人の少年     本のコンビニ ときのテンション 
#>           "2の4"           "2の4"           "2の4"           "2の4"           "2の4" 
#>       内の喜多村     ただの夕焼け     12のポエジー 
#>           "2の4"           "2の4"           "2の4"
```

### 3の3


```r
quanteda::textplot_xray(
  quanteda::kwic(toks, pattern = "3の3", valuetype = "fixed")
)
```

![unnamed-chunk-26-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/228173/90bc17eb-282c-0a32-c5da-6e10f0a0c831.png)



```r
a_b %>%
  purrr::keep(. == "3の3")
#> ゼリーのにおい   理想のトマト       宇宙の渚   胃酸のにおい   ビーチの作法   硝子のさかな 
#>         "3の3"         "3の3"         "3の3"         "3の3"         "3の3"         "3の3" 
#> カレーのパウチ   ティーの温度       昨日の私     祭りの射的       桜の老樹       私の味方 
#>         "3の3"         "3の3"         "3の3"         "3の3"         "3の3"         "3の3" 
#> ブランのしびれ   ポテトの塩気   しっぽの動き   馴染みの本屋       少女の聖       本気の照 
#>         "3の3"         "3の3"         "3の3"         "3の3"         "3の3"         "3の3"
```

### 4の4


```r
quanteda::textplot_xray(
  quanteda::kwic(toks, pattern = "4の4", valuetype = "fixed")
)
```

![unnamed-chunk-28-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/228173/0a53e198-243d-ae25-20b5-5b7cb9f962e2.png)


```r
a_b %>%
  purrr::keep(. == "4の4")
#>     ロボットの篠原     ロボットの篠原     ロボットの篠原       自転車の重心 
#>             "4の4"             "4の4"             "4の4"             "4の4" 
#>       税務署の建物         我々の劣等       分間の夕暮れ コンビニのおにぎり 
#>             "4の4"             "4の4"             "4の4"             "4の4" 
#>         北国の出身         人生の灯台 
#>             "4の4"             "4の4"
```

## セッション情報


```r
devtools::session_info()
#> - Session info ---------------------------------------------------------------------------
#>  setting  value                       
#>  version  R version 4.0.2 (2020-06-22)
#>  os       Windows 10 x64              
#>  system   x86_64, mingw32             
#>  ui       RStudio                     
#>  language (EN)                        
#>  collate  Japanese_Japan.932          
#>  ctype    Japanese_Japan.932          
#>  tz       Asia/Tokyo                  
#>  date     2020-09-28                  
#> 
#> - Packages -------------------------------------------------------------------------------
#>  ! package      * version  date       lib source                             
#>    assertthat     0.2.1    2019-03-21 [1] CRAN (R 4.0.2)                     
#>    backports      1.1.10   2020-09-15 [1] CRAN (R 4.0.2)                     
#>    blob           1.2.1    2020-01-20 [1] CRAN (R 4.0.2)                     
#>    blogdown       0.20     2020-06-23 [1] CRAN (R 4.0.2)                     
#>    bookdown       0.20     2020-06-23 [1] CRAN (R 4.0.2)                     
#>    broom          0.7.0    2020-07-09 [1] CRAN (R 4.0.2)                     
#>    callr          3.4.4    2020-09-07 [1] CRAN (R 4.0.2)                     
#>    cellranger     1.1.0    2016-07-27 [1] CRAN (R 4.0.2)                     
#>    cleanNLP     * 3.0.2    2020-03-08 [1] CRAN (R 4.0.2)                     
#>    cli            2.0.2    2020-02-28 [1] CRAN (R 4.0.2)                     
#>    colorspace     1.4-1    2019-03-18 [1] CRAN (R 4.0.2)                     
#>    conifer        0.0.4    2020-09-26 [1] local                              
#>    crayon         1.3.4    2017-09-16 [1] CRAN (R 4.0.2)                     
#>    curl           4.3      2019-12-02 [1] CRAN (R 4.0.2)                     
#>    data.table     1.13.0   2020-07-24 [1] CRAN (R 4.0.2)                     
#>    DBI            1.1.0    2019-12-15 [1] CRAN (R 4.0.2)                     
#>    dbplyr         1.4.4    2020-05-27 [1] CRAN (R 4.0.2)                     
#>    desc           1.2.0    2018-05-01 [1] CRAN (R 4.0.2)                     
#>    devtools       2.3.2    2020-09-18 [1] CRAN (R 4.0.2)                     
#>    digest         0.6.25   2020-02-23 [1] CRAN (R 4.0.2)                     
#>    dplyr        * 1.0.2    2020-08-18 [1] CRAN (R 4.0.2)                     
#>    ellipsis       0.3.1    2020-05-15 [1] CRAN (R 4.0.2)                     
#>    evaluate       0.14     2019-05-28 [1] CRAN (R 4.0.2)                     
#>    fansi          0.4.1    2020-01-08 [1] CRAN (R 4.0.2)                     
#>    farver         2.0.3    2020-01-16 [1] CRAN (R 4.0.2)                     
#>    fastmatch      1.1-0    2017-01-28 [1] CRAN (R 4.0.0)                     
#>    flatxml        0.1.0    2020-07-24 [1] CRAN (R 4.0.2)                     
#>    float          0.2-4    2020-04-22 [1] CRAN (R 4.0.0)                     
#>    forcats      * 0.5.0    2020-03-01 [1] CRAN (R 4.0.2)                     
#>    fs             1.5.0    2020-07-31 [1] CRAN (R 4.0.2)                     
#>    generics       0.0.2    2018-11-29 [1] CRAN (R 4.0.2)                     
#>    ggplot2      * 3.3.2    2020-06-19 [1] CRAN (R 4.0.2)                     
#>    glue           1.4.2    2020-08-27 [1] CRAN (R 4.0.2)                     
#>    googledrive    1.0.1    2020-05-05 [1] CRAN (R 4.0.2)                     
#>    gtable         0.3.0    2019-03-25 [1] CRAN (R 4.0.2)                     
#>    haven          2.3.1    2020-06-01 [1] CRAN (R 4.0.2)                     
#>    highr          0.8      2019-03-20 [1] CRAN (R 4.0.2)                     
#>    hms            0.5.3    2020-01-08 [1] CRAN (R 4.0.2)                     
#>    htmltools      0.5.0    2020-06-16 [1] CRAN (R 4.0.2)                     
#>    httr           1.4.2    2020-07-20 [1] CRAN (R 4.0.2)                     
#>    igraph         1.2.5    2020-03-19 [1] CRAN (R 4.0.2)                     
#>    jsonlite       1.7.1    2020-09-07 [1] CRAN (R 4.0.2)                     
#>    knitr          1.30     2020-09-22 [1] CRAN (R 4.0.2)                     
#>    labeling       0.3      2014-08-23 [1] CRAN (R 4.0.0)                     
#>    lattice        0.20-41  2020-04-02 [2] CRAN (R 4.0.2)                     
#>    lgr            0.3.4    2020-03-20 [1] CRAN (R 4.0.2)                     
#>    lifecycle      0.2.0    2020-03-06 [1] CRAN (R 4.0.2)                     
#>    lubridate      1.7.9    2020-06-08 [1] CRAN (R 4.0.2)                     
#>    magrittr       1.5      2014-11-22 [1] CRAN (R 4.0.2)                     
#>    Matrix         1.2-18   2019-11-27 [2] CRAN (R 4.0.2)                     
#>    memoise        1.1.0    2017-04-21 [1] CRAN (R 4.0.2)                     
#>    mlapi          0.1.0    2017-12-17 [1] CRAN (R 4.0.2)                     
#>    modelr         0.1.8    2020-05-19 [1] CRAN (R 4.0.2)                     
#>    munsell        0.5.0    2018-06-12 [1] CRAN (R 4.0.2)                     
#>    pillar         1.4.6    2020-07-10 [1] CRAN (R 4.0.2)                     
#>    pipian         0.2.3    2020-08-11 [1] Github (paithiov909/pipian@7097360)
#>    pkgbuild       1.1.0    2020-07-13 [1] CRAN (R 4.0.2)                     
#>    pkgconfig      2.0.3    2019-09-22 [1] CRAN (R 4.0.2)                     
#>    pkgload        1.1.0    2020-05-29 [1] CRAN (R 4.0.2)                     
#>    prettyunits    1.1.1    2020-01-24 [1] CRAN (R 4.0.2)                     
#>    processx       3.4.4    2020-09-03 [1] CRAN (R 4.0.2)                     
#>    ps             1.3.4    2020-08-11 [1] CRAN (R 4.0.2)                     
#>    purrr        * 0.3.4    2020-04-17 [1] CRAN (R 4.0.2)                     
#>    quanteda       2.1.2    2020-09-23 [1] CRAN (R 4.0.2)                     
#>    R.cache        0.14.0   2019-12-06 [1] CRAN (R 4.0.2)                     
#>    R.methodsS3    1.8.1    2020-08-26 [1] CRAN (R 4.0.2)                     
#>    R.oo           1.24.0   2020-08-26 [1] CRAN (R 4.0.2)                     
#>    R.utils        2.10.1   2020-08-26 [1] CRAN (R 4.0.2)                     
#>    R6             2.4.1    2019-11-12 [1] CRAN (R 4.0.2)                     
#>    Rcpp           1.0.5    2020-07-06 [1] CRAN (R 4.0.2)                     
#>  D RcppParallel   5.0.2    2020-06-24 [1] CRAN (R 4.0.2)                     
#>    RcppProgress   0.4.2    2020-02-06 [1] CRAN (R 4.0.2)                     
#>    readr        * 1.3.1    2018-12-21 [1] CRAN (R 4.0.2)                     
#>    readtext       0.80     2020-09-22 [1] CRAN (R 4.0.2)                     
#>    readxl         1.3.1    2019-03-13 [1] CRAN (R 4.0.2)                     
#>    remotes        2.2.0    2020-07-21 [1] CRAN (R 4.0.2)                     
#>    reprex         0.3.0    2019-05-16 [1] CRAN (R 4.0.2)                     
#>    reticulate   * 1.16     2020-05-27 [1] CRAN (R 4.0.2)                     
#>    RhpcBLASctl    0.20-137 2020-05-17 [1] CRAN (R 4.0.0)                     
#>  D rJava          0.9-13   2020-07-06 [1] CRAN (R 4.0.2)                     
#>    rlang          0.4.7    2020-07-09 [1] CRAN (R 4.0.2)                     
#>    rmarkdown      2.3      2020-06-18 [1] CRAN (R 4.0.2)                     
#>    rprojroot      1.3-2    2018-01-03 [1] CRAN (R 4.0.2)                     
#>    rsparse        0.4.0    2020-04-01 [1] CRAN (R 4.0.2)                     
#>    rstudioapi     0.11     2020-02-07 [1] CRAN (R 4.0.2)                     
#>    rtweet         0.7.0    2020-01-08 [1] CRAN (R 4.0.2)                     
#>    rvest          0.3.6    2020-07-25 [1] CRAN (R 4.0.2)                     
#>    scales         1.1.1    2020-05-11 [1] CRAN (R 4.0.2)                     
#>    sessioninfo    1.1.1    2018-11-05 [1] CRAN (R 4.0.2)                     
#>    spacyr         1.2.1    2020-03-04 [1] CRAN (R 4.0.2)                     
#>    stopwords      2.0      2020-04-14 [1] CRAN (R 4.0.2)                     
#>    stringdist     0.9.6    2020-07-16 [1] CRAN (R 4.0.2)                     
#>    stringi        1.5.3    2020-09-09 [1] CRAN (R 4.0.2)                     
#>    stringr      * 1.4.0    2019-02-10 [1] CRAN (R 4.0.2)                     
#>    styler         1.3.2    2020-02-23 [1] CRAN (R 4.0.2)                     
#>    tangela        0.0.3    2020-07-26 [1] local                              
#>    testthat       2.3.2    2020-03-02 [1] CRAN (R 4.0.2)                     
#>    text2vec       0.6      2020-02-18 [1] CRAN (R 4.0.2)                     
#>    textmineR      3.0.4    2019-04-18 [1] CRAN (R 4.0.2)                     
#>    tibble       * 3.0.3    2020-07-10 [1] CRAN (R 4.0.2)                     
#>    tidyr        * 1.1.2    2020-08-27 [1] CRAN (R 4.0.2)                     
#>    tidyselect     1.1.0    2020-05-11 [1] CRAN (R 4.0.2)                     
#>    tidyverse    * 1.3.0    2019-11-21 [1] CRAN (R 4.0.2)                     
#>    udpipe         0.8.3    2019-07-05 [1] CRAN (R 4.0.2)                     
#>    usethis        1.6.3    2020-09-17 [1] CRAN (R 4.0.2)                     
#>    utf8           1.1.4    2018-05-24 [1] CRAN (R 4.0.2)                     
#>    vctrs          0.3.4    2020-08-29 [1] CRAN (R 4.0.2)                     
#>    viridisLite    0.3.0    2018-02-01 [1] CRAN (R 4.0.2)                     
#>    withr          2.3.0    2020-09-22 [1] CRAN (R 4.0.2)                     
#>    xfun           0.17     2020-09-09 [1] CRAN (R 4.0.2)                     
#>    xml2           1.3.2    2020-04-23 [1] CRAN (R 4.0.2)                     
#>    yaml           2.2.1    2020-02-01 [1] CRAN (R 4.0.0)                     
#> 
#> [1] C:/Users/user/Documents/R/win-library/4.0
#> [2] C:/Program Files/R/R-4.0.2/library
#> 
#>  D -- DLL MD5 mismatch, broken installation.
```
