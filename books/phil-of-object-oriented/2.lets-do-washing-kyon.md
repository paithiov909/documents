---
title: "キョン、洗濯をするわよ！！"
free: true
---

## キョン、洗濯をするわよ！！

あなたが洗濯をする場面を考えよう。

あなたがそこそこ文明的な街に暮らしている一般的な現代人ならば、たまたま靴下を一足だけ洗いたいとかじゃないかぎり、おもむろに洗濯板を取り出してきたりはしないと思う。たぶん洗濯物の山を抱え、洗濯機が設置されている場所に行き、諸々を洗濯槽の中にぶち込むはずだ。太古の洗濯機は二層式というやつだったらしいが、それは今ではとてもめずらしい。あなたが洗濯に処したいブツをぶち込み、イイ感じにボタンを押してやれば、あとは洗濯機がすすぎ・脱水・乾燥までをよしなにこなしてくれる。

最近の全自動洗濯機には（あらかじめ人手でセットしておく必要はあるものの）洗剤や柔軟剤を自動投入してくれるものまであるのだ。いやはや超便利じゃないですか。私の母は洗濯が家事のなかでは一番好きだと言っていた。いわく「だって、自分でやらなくていいじゃない。」ほんとそのとおりだよね。科学のチカラってすげー。

そんな全自動洗濯機をもっとも偉大たらしめているステキ要素といえば、何と言ってもマルチタスクを可能としている点だろう。今しがた洗濯機を稼働させ、いよいよ洗濯ルーチンを軌道に乗せたあなたは、たまたま某所へ郵送しなければならない書類があったことを思い出した。そこで、洗濯しながら近所のポストまで出かけることにした。ところが、ここでのどかな日常は急転直下、縁起でもないことだが、あなたはポストの手前の横断歩道を渡っている途中で黒塗りの高級車に追突されてしまう。不幸にも即死であった。許すまじ上級国民。私は涙ながらに「将来はきっと早めに免許返納をしてやるわよ」という決意を固くするのだった（完）。

## 後見人は誰？

さて、あなたの人生は惜しむらくもここで終了したわけだが、このとき実はちょっと困った状況が生じている。あなたはつい先ほど洗濯をはじめたばかりだった。実際、あなたが稼働させた洗濯機はいまだぐるぐると元気よく回り続けているものとする。つまり、あなたの洗濯は、まだ終わっていないように見える。しかし、洗濯をはじめた当人であるあなたは先ほど死んでしまった。このとき、あなたのはじめた洗濯行為はいったいどのようなかたちで「終了」するのだろうか。

あなたがプロセス管理に慣れているエンジニアならば、これってつまり「非同期処理の最中にタスクを投げた当の親プロセスが死んだ場合、子プロセスはどうなるのか？」問題と同じことじゃんと理解したことだろう。C/C++やJavaを書く人だったら、次のStack Overflowのスレッドを読んだことがあるかもしれない。

- [c++ - Are child processes created with fork() automatically killed when the parent is killed? - Stack Overflow](https://stackoverflow.com/questions/395877/are-child-processes-created-with-fork-automatically-killed-when-the-parent-is)
- [java - How can I cause a child process to exit when the parent does? - Stack Overflow](https://stackoverflow.com/questions/269494/how-can-i-cause-a-child-process-to-exit-when-the-parent-does)

これがソフトウェア開発上の技術的な疑問なのであれば、これらのスレッドに書かれているanswerを信頼して、適当な対応をすればよい。こういった「親を失ったプロセス」は[orphan process](https://en.wikipedia.org/wiki/Orphan_process)と呼ばれ、モダンなUnixライクなシステムではOSの責任のもとで管理されることになる。orphan processはさしあたり”init”プロセスの管理下で「後見」される仕組みになっており、この処理はre-parentingと呼ばれる。つまり、親プロセスが予期せず死んだとしても、子プロセスがそのシグナルを受け取ってどうこうする処理があらかじめ書かれているのでないかぎり、子プロセスはただちに終了したりしない。そういうふうにできているからだ。

## じゃあこの洗濯はいつ終わるのか

しかし、当たり前だが、あなたがこの世にやり残していった洗濯はべつにUnixライクなシステム上で走っているプロセスなのではない。もちろん、一度動きはじめた洗濯機は、あなたがいなくなったこの世界においても確かに洗濯を続けてくれる。控えめに言ってよく出来たスグレモノだ。持ち主の後を追うかのごとく黒塗りの高級車に追突されてぶっ壊れるとかしないかぎり、洗濯機はあなたの当初の期待通り、すすぎ・脱水・乾燥までを首尾よくこなしたうえで、正しく停止することだろう。

「じゃあこの洗濯はいつ終わるのか」問題に直面するとき、私たちの直観は、おそらくいくつかのパターンに割れる。

ひとつめ、洗濯は終わらない。洗濯行為が正常に終了するためには、洗濯機が停止した後で、その中から衣類が取り出され、それらがベランダに干されたうえで、日没を待たず取り込まれて収納されるまでの一連のプロセスがまるごと実行されなければならない。したがって、あなたの洗濯は洗濯機の責務である乾燥までのpromiseがresolveされた時点で「中断」されたままとなり、ついに宇宙そのものが終わりを迎える日が訪れる（無駄に壮大なスケールになるSF感すこ）。

ふたつめ、洗濯は洗濯機が停止した時点で終わる。洗濯とはようするに洗濯機を回すことにほかならない。したがって、洗濯機が停止してくれさえすれば、それで洗濯は正常に終了する。きっとあなたが三途の川を渡り終えたころにでも「やってやったぜ！」とガッツポーズできる算段である（家事をやりたがらないマンはこういうことを言いがち）。

みっつめ、洗濯はあなたが死んだ時点ですでに「異常終了」している。洗濯をはじめた人が死亡した後については、洗濯機は単に事実として動き続けているだけである。したがって、あなたが死んだ後のことなんてあなたが知ったこっちゃないだろうし、三途の川とか実在しないのでどうでもよい（それはそう）。

